#                成绩管理系统数据库说明文档

## 一、基本表

​		成绩管理系统中的基本表包括学生表、家长表、管理员表、教师表和班级表。这些基本表之间的关系符合数据库设计的规范化要求。

**（1）以下是学生表包含的内容：**

| 列名              | 数据类型     | 说明       |
| ----------------- | ------------ | ---------- |
| **StudentID**     | INT (主键)   | 学生的学号 |
| **Name**          | VARCHAR(100) | 学生的姓名 |
| **Gender**        | VARCHAR(100) | 学生的性别 |
| **Class**         | INT          | 学生的班级 |
| **Patriarchname** | VARCHAR(100) | 家长姓名   |
| **TeacherID**     | INT          | 教师的工号 |
| **ClassID**       | INT          | 班级编号   |

1. 学生学号：学生的学号，用于唯一标识学生。
2. 学生姓名：学生的姓名，用于唯一标识学生。
3. 班级：学生所在的班级或年级。
4. 性别：学生的性别，用于区分男女学生。
5. 家长姓名：学生的家长或监护人姓名，用于与家长进行联系。
6. 教师工号：教授的学生。
7. 班级编号：学生的所属班级。

 

**以下是学生表的约束条件：**

1. 主键约束（Primary Key Constraint）：学生表中的学生编号（Student ID）是主键，确保每个学生有唯一的标识符，防止重复数据的插入。

2. 外键约束（Foreign Key Constraint）：学生表与其他表存在关联关系，比如与班级表关联，设置了外键约束来确保关联字段的完整性，防止删除或更新数据时产生不一致。

3. 唯一约束（Unique Constraint）：学生学号（Student Number）是唯一约束，确保学生学号的唯一性，避免重复的学号。

4. 非空约束（Not Null Constraint）：学生表中一些字段，如学生姓名、性别、等，设置了非空约束，确保必要信息的完整性，避免空值的插入。

5. 检查约束（Check Constraint）：对于一些字段，如年龄（Age）、性别（Gender）等，设置了检查约束，限制字段的取值范围，确保数据的有效性。



**（2）以下是家长表包含的内容：**

| 列名         | 数据类型      | 说明             |
| ------------ | ------------- | ---------------- |
| StudentID    | INT (10)      | 学生的学号       |
| Name         | VARCHAR(主键) | 家长的姓名       |
| Relationship | VARCHAR(10)   | 家长与学生的关系 |
| Number       | INT           | 家长的电话       |
| Address      | VARCHAR(100)  | 家庭地址         |

1. 家长姓名：家长或监护人的姓名。

2. 关系：家长与学生的关系，如父母、祖父母、姐姐等。

3. 联系电话：家长的联系电话，用于紧急联系或重要通知。

4. 学生学号：与家长关联的学生学号，用于唯一标识学生。

5. 家庭地址：家庭的详细地址，用于邮寄成绩单或其他重要文件。

   

**以下是家长表的约束条件：**

1. 主键约束：通家长表设置一个主键，用于唯一标识每个家长记录。

2. 外键约束：家长表与其他表存在关联关系，比如与学生表或班级表关联，设置了外键约束来确保关联字段的一致性和完整性。

3. 非空约束：在家长表中，一些重要字段如姓名、联系方式等不能为空。

4. 唯一约束：在家长表中，某些字段具有唯一性，比如家长的学生或联系方式。

   

**（3）以下是管理员表包含的内容：**

| 列名            | 数据类型     | 说明         |
| --------------- | ------------ | ------------ |
| ID              | INT (主键)   | 管理员的id   |
| Name            | VARCHAR(10)  | 管理员的姓名 |
| Account  number | VARCHAR(10)  | 管理员的账号 |
| password        | INT          | 管理员的密码 |
| Number          | VARCHAR(100) | 管理员的电话 |

1. 管理员姓名：管理员的姓名，用于唯一标识管理员。

2. 管理员账号：管理员登录系统的账号，用于验证身份和权限。

3. 管理员密码：管理员登录系统的密码，用于验证身份和权限。

4. 联系方式：管理员的联系方式，用于系统通知或紧急联系。

   

**以下是应用于管理员表的约束说明：**

1. 主键约束：管理员表设置了一个主键，用于唯一标识每个管理员记录。确保每个管理员都有一个唯一的标识符，方便系统进行数据操作和查询。

2. 唯一约束：管理员表中的用户名字段具有唯一性，以确保每个管理员都有唯一的登录凭证，避免重复的管理员账号。

3. 非空约束：管理员表中的重要字段如姓名、用户名、密码等不能为空，以确保这些信息的完整性。

4. 检查约束：检查约束来验证管理员输入的密码是否符合规定的格式要求，比如密码长度是否符合要求、是否包含特殊字符等。

5. 外键约束：管理员表与其他表存在关联关系，比如与权限表或日志表关联，设置了外键约束来确保关联字段的一致性和完整性。

   

**（4）以下是教师表包含的内容：**

| 列名       | 数据类型     | 说明       |
| ---------- | ------------ | ---------- |
| TeacherID  | INT (主键)   | 教师的工号 |
| TeachName  | VARCHAR(10)  | 教师的姓名 |
| Gender     | VARCHAR(10)  | 教师的性别 |
| Teachclass | INT          | 教学班级   |
| Number     | VARCHAR(100) | 教师的电话 |

1. 教师工号：作为教师的唯一标识符。

2. 姓名：教师的姓名。

3. 性别：教师的性别。

4. 手机号码：教师的联系电话。

5. 教学班级：教师教学的班级信息。

   

**以下是应用于教师表的约束说明：**

1. 主键约束：教师表设置了一个主键，用于唯一标识每个教师记录。这样可以确保每个教师都有一个唯一的标识符，方便系统进行数据操作和查询。

2. 非空约束：通常会要求教师表中的重要字段如姓名、工号、密码等不能为空，以确保这些信息的完整性。

3. 外键约束：教师表与其他表存在关联关系，比如与课程表或成绩表关联，设置了外键约束来确保关联字段的一致性和完整性。

   

**（5）以下是班级表包含以下内容：**

| 列名         | 数据类型    | 说明         |
| ------------ | ----------- | ------------ |
| classID      | INT (主键)  | 班级编号     |
| TeachName    | VARCHAR(10) | 教师的姓名   |
| Studentclass | INT         | 班级学生列表 |

1. 班级编号：每个班级都有一个唯一的编号，用于区分不同班级。

2. 教师姓名：负责该班级的教师的姓名。

3. 班级学生列表：列出班级中每个学生的姓名、学号和成绩，可以通过这个列表查看每个学生的具体情况。

   

**以下是相关班级表的约束条件：**

1. 主键约束（Primary Key Constraint）：班级表中的班级编号（Class ID）被设为主键，确保每个班级有唯一的标识符，防止重复数据的插入。

2. 外键约束（Foreign Key Constraint）：班级表与其他表存在关联关系，比如与学生表关联，设置外键约束来确保关联字段的完整性，防止删除或更新数据时产生不一致。

3. 唯一约束（Unique Constraint）：班级名称（Class Name）设置唯一约束，确保班级名称的唯一性，避免出现重名的班级。

4. 非空约束（Not Null Constraint）：班级表中一些字段，如班级名称、年级等，需要设置非空约束，确保必要信息的完整性，避免空值的插入。

5. 默认约束（Default Constraint）：对于一些字段，如创建时间（Creation Time），设置默认值约束，确保字段有默认数值，避免空值或错误值的插入。

   

**下面是针对这些表需要用到的触发器说明：**

**1.** **学生表和家长表的触发器：**

​		在插入学生或者家长信息时，设置了一个触发器来计算学生或者家长的年龄，并更新到学生表或者家长表中的年龄字段。

​		在删除学生或者家长信息时，设置了一个触发器来级联删除该学生或者家长的信息，确保数据的一致性。

**2.** **管理员表的触发器：**

​		在更新信息时，设置了一个触发器来检查是否密码正确，如果有则阻止更新操作。

**3.** **班级表的触发器：**

​		在插入数据时，设置了一个在插入新班级记录时触发的触发器，用于自动化地在其他相关表中插入一些默认信息，比如在学生表中为该班级的学生插入默认的成绩信息。

​		在更新数据时，设置了一个在更新班级信息时触发的触发器，用于自动化地更新相关表中的信息，比如更新该班级的学生信息时同时更新学生表中相关学生的班级信息。

​		在删除数据时，设置了一个在删除班级记录时触发的触发器，用于自动化地删除相关表中的信息，比如删除该班级的信息时同时删除学生表和课程表中与该班级相关的信息。

**4.** **教师表的触发器：**

​		在插入数据时，设置了一个在插入新教师记录时触发的触发器，用于自动化地在其他相关表中插入一些默认信息，比如在课程表中为该教师插入默认的授课信息或在成绩表中为该教师的学生成绩插入默认的成绩信息。

​		在更新数据时，设置了一个在更新教师信息时触发的触发器，用于自动化地更新相关表中的信息，比如更新该教师的信息时同时更新课程表中相关课程的教师信息。

​		在删除数据时，设置了一个在删除教师记录时触发的触发器，用于自动化地删除相关表中的信息，比如删除该教师的信息时同时删除课程表和成绩表中与该教师相关的信息。



## 二、视图

1. **学生界面**：

     查看个人成绩：显示学生自己的各科成绩，包括考试成绩和平时成绩。

     查看班级排名：显示学生所在班级各科目的成绩排名。

     查看个人信息：显示学生的个人信息，如姓名、学号、班级等。

     修改个人密码：允许学生修改登录密码。

2. **家长界面**：

     查看子女成绩：显示家长子女的各科成绩，包括考试成绩和平时成绩。

     查看子女个人信息：显示子女的个人信息，如姓名、学号、班级等。

    联系教师：提供与子女的任课教师沟通的功能，可以发送消息或预约面谈。

3. **教师界面**：

     输入学生成绩：允许教师录入学生成绩，包括考试成绩、平时成绩等。

     查看班级成绩：显示教师所教班级学生的各科成绩情况。

     查看个人信息：显示教师的个人信息，如姓名、教工号、所教班级等。

     修改个人密码：允许教师修改登录密码。

4. **管理员界面**：

     添加学生信息：允许管理员添加新的学生信息到系统中，包括姓名、学号、班级等。

     添加教师信息：允许管理员添加新的教师信息到系统中，包括姓名、教工号、所教班级等。

     班级管理：允许管理员管理班级信息，包括添加、删除班级等操作。

     数据统计与分析：提供学校各班级成绩统计数据的查看，并支持分析功能，如成绩趋势分析、班级比较等。

   

## 三、存储程序/函数

### 1. 用户注册

#### 存储程序/函数名称

  	**名称**：register_user

#### 功能

 	 新用户注册，将用户信息插入到用户表中。

#### 参数

​		**用户名**（username）：新用户的用户名，用于登录。

​		**密码**（password）：新用户的密码，需经过加密处理。

​		**昵称**（nickname）：新用户的昵称，用于显示。

​		**角色**（role）：新用户的角色，例如学生、教师、管理员等。

#### 返回值

​		**成功**：返回注册用户的用户ID。

​		**失败**：返回错误信息，例如用户名已存在等。

#### SQL示例

```sql
CREATE PROCEDURE register_user (
    IN p_username VARCHAR(50),
    IN p_password VARCHAR(255),
    IN p_nickname VARCHAR(50),
    IN p_role VARCHAR(50),
    OUT p_user_id INT
)
BEGIN
    DECLARE existing_user INT;

    -- 检查用户名是否已存在
    SELECT COUNT(*) INTO existing_user FROM users WHERE username = p_username;

    IF existing_user > 0 THEN
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = '用户名已存在';
    ELSE
        -- 插入新用户信息
        INSERT INTO users (username, password, nickname, role, register_time)
        VALUES (p_username, p_password, p_nickname, p_role, NOW());

        -- 获取新用户的ID
        SELECT LAST_INSERT_ID() INTO p_user_id;
    END IF;
END;
```

### 2. 用户登录

#### 存储程序/函数名称

​		**名称**：login_user

#### 功能

​		用户登录验证，检查用户名和密码是否匹配。

#### 参数

​		**用户名**（username）：用户输入的用户名。

​		**密码**（password）：用户输入的密码，需经过加密处理。

#### 返回值

​		**成功**：返回登录用户的用户ID。

​		**失败**：返回错误信息，例如用户名或密码错误等。

#### SQL示例

```sql
CREATE PROCEDURE login_user (
    IN p_username VARCHAR(50),
    IN p_password VARCHAR(255),
    OUT p_user_id INT
)
BEGIN
    DECLARE user_id INT;

    -- 检查用户名和密码是否匹配
    SELECT user_id INTO user_id
    FROM users
    WHERE username = p_username AND password = p_password;

    IF user_id IS NOT NULL THEN
        SET p_user_id = user_id;
    ELSE
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = '用户名或密码错误';
    END IF;
END;
```

### 3. 显示用户信息（用户名/昵称/角色/注册时间）

#### 存储程序/函数名称

​		**名称**：get_user_info

#### 功能

​		根据用户ID获取用户的详细信息，包括用户名、昵称、角色、注册时间等。

#### 参数

​		**用户ID**（user_id）：要获取信息的用户ID。

#### 返回值

​		用户详细信息，包括用户名、昵称、角色、注册时间等。

#### SQL示例

```sql
CREATE PROCEDURE get_user_info (
    IN p_user_id INT
)
BEGIN
    SELECT username, nickname, role, register_time
    FROM users
    WHERE user_id = p_user_id;
END;
```

## 数据库交互方式

​		存储程序/函数通过数据库连接进行与数据库的交互，执行相应的SQL语句来完成用户信息的注册、登录以及获取用户信息等操作。开发者可以在应用程序中调用这些存储程序/函数来实现成绩管理系统的用户管理功能。



​		